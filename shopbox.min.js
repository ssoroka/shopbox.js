(function(){var i,c=function(a,c){return function(){return a.apply(c,arguments)}};i=function(){function a(){}var f;a.box=null;a.template='<div id="shopbox" class="shopbox-hidden"><div id="shopbox-spinner" class="shopbox-spinner">Loading</div><span id="shopbox-loading-message">Click anywhere to close</span><div id="shopbox-main"><a id="shopbox-close" href="#">Close</a><div id="shopbox-content"></div></div></div>';a.init=c(function(){if($("#shopbox").length===0)return $("body").prepend(this.template),
this.wrapper=$("#shopbox"),this.spinner=this.wrapper.find("#shopbox-spinner"),this.loading_message=this.wrapper.find("#shopbox-loading-message"),this.main=this.wrapper.find("#shopbox-main"),this.close=this.main.find("#shopbox-close"),this.content=this.main.find("#shopbox-content"),this.visible="shopbox-visible",this.hidden="shopbox-hidden",this.loaded="shopbox-loaded",this.close.click(this.closeBox),$(window).bind("keydown",c(function(b){if(b.which===27)return this.closeBox()},this)),$(this.wrapper,
this.spinner).bind("click",c(function(b){if(b.target===this.wrapper[0])return this.closeBox()},this))},a);a.show=c(function(){this.wrapper.removeClass(this.hidden);return setTimeout(c(function(){return this.wrapper.addClass(this.visible)},this),0)},a);a.closeBox=c(function(b){b&&b.preventDefault();return this.hide()},a);a.hide=c(function(){if(this.wrapper.hasClass(this.visible))return this.wrapper.removeClass(this.visible),this.wrapper.transitionEnd(c(function(){this.wrapper.addClass(this.hidden).removeClass(this.loaded);
return this.main.removeClass(this.visible)},this))},a);a.startSpinner=c(function(){this.spinner.addClass(this.visible);this.loading_message.addClass(this.visible);return this.main.removeClass(this.visible)},a);a.finishSpinner=c(function(b){b=b.target||b;this.loading_message.removeClass(this.visible);this.spinner.removeClass(this.visible);this.main.addClass(this.visible);this.content.html(b);return this.wrapper.addClass(this.loaded)},a);a.setTypeStyle=c(function(b){return this.wrapper.removeClass("shopbox-html shopbox-image shopbox-iframe shopbox-video").addClass(b)},
a);a.loadFromContent=c(function(b,a,d){var g,h,e,f;b==null&&(b=d.attr("href"));d=a.type||this.typeFromContent(b);this.content.css({width:"",height:""});this.main.css({"margin-left":"","margin-top":""});this.show();d!=="content"&&(f=b,a.cache===!1&&(f=""+f+"?"+Math.random()*1E18));this.startSpinner();this.setTypeStyle("shopbox-"+d);console.log(d);switch(d){case "image":return e=$("<img />"),e.hide(),this.content.html(e),e.load(c(function(b){this.setSize({height:a.height||e.height(),width:a.width||
e.width()});e.show();return this.finishSpinner(b)},this)),e.attr("src",f),window.img=e;case "iframe":return h=$("<iframe></iframe>"),h.hide(),d={height:a.height||400,width:a.width||600},h.css(d),this.setSize(d),h.load(c(function(b){h.show();return this.finishSpinner(b)},this)),h.attr("src",f),this.content.html(h);default:return g=$("<div />"),g.hide(),this.content.html(g),g.ready(c(function(){return setTimeout(c(function(){this.setSize({height:a.height||g.height(),width:a.width||g.width()});g.remove();
return this.finishSpinner(b)},this),0)},this)),g.html(b)}},a);a.setSize=c(function(b){var a,c;c=document.width-50;a=document.height-50;b.height||(b.height=400);b.width||(b.width=600);if(c<b.width)b.width=c;if(a<b.height)b.height=a;console.log(b);this.content.css(b);return this.main.css({"margin-left":-b.width/2-10,"margin-top":-b.height/2-10})},a);f=["jpg","jpeg","png","bmp","gif"];a.typeFromContent=c(function(b){var a;if(b.nodeType!=null||b instanceof jQuery)return"object";a=b.split(".").pop().toLowerCase();
return f.indexOf(a)>=0?"image":b.match(/^https?\:\/\/\S+$/)?"iframe":"html"},a);return a}.call(this);window.ShopBox=i;jQuery.fn.shopbox=function(a,c){c==null&&(c={});i.init();return this.each(function(b,j){return $(j).click(function(b){b.preventDefault();return i.loadFromContent(a,c,$(j))})})};jQuery.fn.transitionEnd=function(a){return this.one("TransitionEnd webkitTransitionEnd transitionend oTransitionEnd",a)}}).call(this);
